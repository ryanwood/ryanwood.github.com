
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ubuntu Hardy Lts Slice With Nginx, Passenger, Git, Vlad And More! - knock.on_wood</title>
  <meta name="author" content="Ryan Wood">

  
  <meta name="description" content="I finally did it. I took notes as I built a server and am posting it (mainly so I don&#8217;t forget). In case someone wants to print this, I left &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ryanwood.github.com/past/2010/01/15/ubuntu-hardy-lts-slice-with-nginx-passenger-git-vlad-and-more/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="knock.on_wood" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText"></div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">knock.on_wood</a></h1>
  
    <h2>Unclear thoughts on Software Development</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ryanwood.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Ubuntu Hardy Lts Slice With Nginx, Passenger, Git, Vlad and More!</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-01-15T18:41:00-05:00" pubdate data-updated="true">Jan 15<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I finally did it. I took notes as I built a server and am posting it (mainly so I don&#8217;t forget). In case someone wants to print this, I left most of the URLs in text so you&#8217;d be able to read them. So here it goes.</p>

<p>I am doing this on <a href="http://slicehost.com">Slicehost</a> and decided to user Ubuntu Hardy 8.04.2 as the OS maily for the long term support.</p>

<h1>Core Setup</h1>

<h2>Initial Config</h2>

<p><a href="http://articles.slicehost.com/2008/4/25/ubuntu-hardy-setup-page-1">http://articles.slicehost.com/2008/4/25/ubuntu-hardy-setup-page-1</a>
<a href="http://articles.slicehost.com/2008/4/25/ubuntu-hardy-setup-page-2">http://articles.slicehost.com/2008/4/25/ubuntu-hardy-setup-page-2</a></p>

<h2>Ruby Enterprise Edition, Nginx, Passenger</h2>

<p>I followed this great guide:</p>

<p><a href="http://antoniocangiano.com/2009/11/20/setup-ruby-enterprise-edition-nginx-and-passenger-aka-mod_rails-on-ubuntu/">http://antoniocangiano.com/2009/11/20/setup-ruby-enterprise-edition-nginx-and-passenger-aka-mod_rails-on-ubuntu/</a></p>

<h2>Gems</h2>

<p>The latest version of rubygems was install after install REE.</p>

<pre><code>sudo gem update --system
sudo gem update
</code></pre>

<p>Install all the gems I normally use. Just too many to list.</p>

<p>Create/edit ~/.gemrc with</p>

<pre><code>gem --no-ri --no-rdoc
</code></pre>

<p><a href="http://docs.rubygems.org/read/chapter/11">http://docs.rubygems.org/read/chapter/11</a></p>

<h2>Git</h2>

<p>If you use aptitude, you get an old version 1.5.4.x</p>

<p><a href="http://serengetisunset.wordpress.com/2009/02/28/installing-git-1613-on-ubuntu-804/">http://serengetisunset.wordpress.com/2009/02/28/installing-git-1613-on-ubuntu-804/</a></p>

<p>I did this to get the newest version installed. You need the build dependencies for it to work.</p>

<pre><code>sudo apt-get remove git-core
wget http://kernel.org/pub/software/scm/git/git-1.6.6.tar.gz
sudo apt-get build-dep git-core
tar xvzf git-1.6.6.tar.gz
cd git-1.6.6/
./configure --with-tcltk
make
sudo make install
</code></pre>

<p>Source: <a href="http://brunomiranda.com/past/2008/5/12/deploying_github_repository_with_vlad">http://brunomiranda.com/past/2008/5/12/deploying_github_repository_with_vlad</a></p>

<h2>MySQL</h2>

<p><a href="http://articles.slicehost.com/mysql">http://articles.slicehost.com/mysql</a></p>

<pre><code>sudo gem install mysql
</code></pre>

<p><em>Migrate existing datbase from Heroku</em></p>

<ol>
<li>sudo gem install taps</li>
<li>Copy your existing .heroku directory from your dev box to the deploy server.</li>
<li>Create your production db</li>
<li>rake db:migrate to get all the struct created</li>
<li><p>Pull that db down. For the prayerthread app:</p>

<pre><code>heroku db:pull --app prayerthread mysql://root:pass@localhost/prayerthread_production
</code></pre></li>
</ol>


<p><a href="http://adamblog.heroku.com/past/2009/2/11/taps_for_easy_database_transfers/">http://adamblog.heroku.com/past/2009/2/11/taps_for_easy_database_transfers/</a></p>

<h2>Mail</h2>

<p><a href="http://articles.slicehost.com/email">http://articles.slicehost.com/email</a></p>

<p><a href="http://articles.slicehost.com/2008/7/28/email-preparing-the-slice">http://articles.slicehost.com/2008/7/28/email-preparing-the-slice</a>
<a href="http://articles.slicehost.com/2008/7/29/postfix-installation">http://articles.slicehost.com/2008/7/29/postfix-installation</a>
<a href="http://articles.slicehost.com/2008/7/31/postfix-basic-settings-in-main-cf">http://articles.slicehost.com/2008/7/31/postfix-basic-settings-in-main-cf</a></p>

<p>Good reference if you&#8217;re setting up a full scale mail server:</p>

<p><a href="http://articles.slicehost.com/2008/9/2/mail-server-slice-setup">http://articles.slicehost.com/2008/9/2/mail-server-slice-setup</a></p>

<h1>Deployment</h1>

<p>Cobbled deploy recipe using:</p>

<p><a href="http://dennisbloete.de/blog/rails-deployment-with-vlad-git-and-passenger">http://dennisbloete.de/blog/rails-deployment-with-vlad-git-and-passenger</a>
<a href="http://snippets.aktagon.com/snippets/264-Vlad-deployment-recipe-for-Phusion-Passenger">http://snippets.aktagon.com/snippets/264-Vlad-deployment-recipe-for-Phusion-Passenger</a></p>

<h2>Deployment Issues</h2>

<p>There were 3 of them:</p>

<ol>
<li><p>Vlad error</p>

<pre><code> Usage: /usr/bin/git-submodule [--quiet] [--cached] [add [-b branch]|status|init|update|summary [-n|--summary-limit ] []] [--] [...]
 rake aborted!
</code></pre>

<p>The issue is because Hardy has an older version of git 1.5.x. Once I upgrade to 1.6, it is fine.</p>

<p>There was a <a href="http://github.com/jbarnette/vlad-git/commit/f6f98fd994a12848b619fd5a82df355b348ac69b">commit</a>
to fix this but it wasn&#8217;t yet in the gem.
I manually patched the gem file. to address
<a href="http://github.com/jbarnette/vlad-git/issues#issue/1">the</a>
<a href="http://github.com/jbarnette/vlad-git/issues#issue/2">issue</a>.</p></li>
<li><p>Cloning from a remote git repo</p>

<p>This is an issue when cloning from unfuddle.com (or github.com). You need
an ssh key to run vlad from the local box to the deploy server, but then vlad
executes the clone from the deploy server so an additional key pair is needed.
I looked at setting up ssh forwarding, but <a href="http://jordanelver.co.uk/articles/2008/07/10/rails-deployment-with-git-vlad-and-ssh-agent-forwarding/">these directions weren&#8217;t clear enough
for me</a>.
couldn&#8217;t find clear enough directions.</p>

<p>Instead, I just created a deploy key pair and uploaded the pub key to unfuddle. That
authenticated me but since I am connecting over a non-standard port, I still had an issue.</p></li>
<li><p>SSH Config for non-standard port</p>

<p>On the deploy box, I needed to tell SSH to use the standard port to connect to unfuddle.
Add the following to <code>~/.ssh/config</code> as noted <a href="http://github.com/guides/addressing-authentication-problems-with-ssh">here, under theSSH Config section</a>:</p>

<pre><code>Host sourcescape.unfuddle.com
  Port 22
  Hostname sourcescape.unfuddle.com
  IdentityFile ~/.ssh/unfuddle_rsa
  TCPKeepAlive yes
  IdentitiesOnly yes
</code></pre></li>
</ol>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ryan Wood</span></span>

      








  


<time datetime="2010-01-15T18:41:00-05:00" pubdate data-updated="true">Jan 15<span>th</span>, 2010</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://ryanwood.github.com/past/2010/01/15/ubuntu-hardy-lts-slice-with-nginx-passenger-git-vlad-and-more/" data-via="ryanwood" data-counturl="http://ryanwood.github.com/past/2010/01/15/ubuntu-hardy-lts-slice-with-nginx-passenger-git-vlad-and-more/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/past/2010/01/15/why-i-left-heroku/" title="Previous Post: Why I Left Heroku">&laquo; Why I Left Heroku</a>
      
      
        <a class="basic-alignment right articlenav" href="/past/2010/01/21/bye-bye-vlad/" title="Next Post: Bye Bye Vlad">Bye Bye Vlad &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/past/2010/11/29/cowork-the-first-month/">Co Work: The First Month</a>
      </li>
    
      <li class="post">
        <a href="/past/2010/09/29/when-will-this-project-be-done/">When Will This Project Be Done?</a>
      </li>
    
      <li class="post">
        <a href="/past/2010/03/14/git-workflow-merge-or-rebase/">Git Workflow: Merge Or Rebase</a>
      </li>
    
      <li class="post">
        <a href="/past/2010/03/01/webbynode-review/">Webbynode Review</a>
      </li>
    
      <li class="post">
        <a href="/past/2010/01/21/fat-free-crm-on-heroku/">Fat Free Crm On Heroku</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/ryanwood">@ryanwood</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ryanwood',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("ryanwood", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/ryanwood" class="twitter-follow-button" data-show-count="false">Follow @ryanwood</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/ryan.wood?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Ryan Wood -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ryanwood';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ryanwood.github.com/past/2010/01/15/ubuntu-hardy-lts-slice-with-nginx-passenger-git-vlad-and-more/';
        var disqus_url = 'http://ryanwood.github.com/past/2010/01/15/ubuntu-hardy-lts-slice-with-nginx-passenger-git-vlad-and-more/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
